# ุชูุถุญ branch_id ุฏุฑ ุณุณุชู ุชฺฉุชูฺฏ

## ๐ branch_id ฺุณุชุ

`branch_id` ฺฉ ููุฏ ุงุฎุชุงุฑ ุฏุฑ ูุฏู `Ticket` ุงุณุช ฺฉู ูุดุฎุต ูโฺฉูุฏ ุชฺฉุช ุจู ฺฉุฏุงู ุดุนุจู (Branch) ูุฑุจูุท ุงุณุช.

## ๐ ุฌุฒุฆุงุช ูู

### ุฏุฑ ูุฏู Ticket (`app/models/ticket.py`):
```python
branch_id = Column(Integer, ForeignKey("branches.id"), nullable=True, index=True)
```

- **ููุน**: `Integer` (ุนุฏุฏ ุตุญุญ)
- **ForeignKey**: ุจู ุฌุฏูู `branches` ู ููุฏ `id` ุขู ุงุดุงุฑู ูโฺฉูุฏ
- **nullable**: `True` - ุนู ูโุชูุงูุฏ `None` ุจุงุดุฏ (ุชฺฉุช ูโุชูุงูุฏ ุจุฏูู ุดุนุจู ุจุงุดุฏ)
- **index**: `True` - ุจุฑุง ุฌุณุชุฌู ุณุฑุนโุชุฑ

### ุฏุฑ Schema (`app/schemas/ticket.py`):
```python
branch_id: Optional[int] = Field(None, description="ุดูุงุณู ุดุนุจู")
```

- **ููุน**: `Optional[int]` - ูโุชูุงูุฏ `None` ุง ฺฉ ุนุฏุฏ ุตุญุญ ุจุงุดุฏ
- **ูพุดโูุฑุถ**: `None` - ุงฺฏุฑ ุงุฑุณุงู ูุดูุฏุ `None` ุฎูุงูุฏ ุจูุฏ

## โ ููุงุฏุฑ ูุนุชุจุฑ

| ููุฏุงุฑ | ูุนู | ูุชุฌู |
|-------|------|-------|
| `None` ุง `null` | ุจุฏูู ุดุนุจู | ุชฺฉุช ุจุฏูู ุดุนุจู ุซุจุช ูโุดูุฏ โ |
| `0` ุง `-1` | ูุงูุนุชุจุฑ | ุจู `None` ุชุจุฏู ูโุดูุฏ โ |
| `1, 2, 3, ...` | ุดูุงุณู ุดุนุจู | ุงฺฏุฑ ุดุนุจู ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏุ ุงุณุชูุงุฏู ูโุดูุฏ โ |
| `999` (ุดุนุจู ูุฌูุฏ ูุฏุงุฑุฏ) | ูุงูุนุชุจุฑ | ุจู `None` ุชุจุฏู ูโุดูุฏ โ |

## ๐ง ููุทู ุงุนุชุจุงุฑุณูุฌ

ุฏุฑ `app/services/ticket_service.py`:

```python
# Validate branch_id if provided
branch_id = ticket_data.branch_id

if branch_id is not None and branch_id <= 0:
    # ุงฺฏุฑ branch_id <= 0 ุจุงุดุฏุ ุจู None ุชุจุฏู ูโุดูุฏ
    branch_id = None
elif branch_id is not None:
    # ุจุฑุฑุณ ูุฌูุฏ ุดุนุจู ุฏุฑ ุฏุชุงุจุณ
    branch = db.query(Branch).filter(Branch.id == branch_id).first()
    if not branch:
        # ุงฺฏุฑ ุดุนุจู ูุฌูุฏ ูุฏุงุดุชู ุจุงุดุฏุ ุจู None ุชุจุฏู ูโุดูุฏ
        branch_id = None
```

## ๐ ูุซุงูโูุง ุงุณุชูุงุฏู

### ูุซุงู ฑ: ุชฺฉุช ุจุฏูู ุดุนุจู
```json
{
  "title": "ูุดฺฉู ุงูุชุฑูุช",
  "description": "ุงูุชุฑูุช ูุทุน ุงุณุช",
  "category": "internet"
}
```
ุง:
```json
{
  "title": "ูุดฺฉู ุงูุชุฑูุช",
  "description": "ุงูุชุฑูุช ูุทุน ุงุณุช",
  "category": "internet",
  "branch_id": null
}
```
ุง:
```json
{
  "title": "ูุดฺฉู ุงูุชุฑูุช",
  "description": "ุงูุชุฑูุช ูุทุน ุงุณุช",
  "category": "internet",
  "branch_id": 0
}
```
**ูุชุฌู**: ููู ุงู ููุงุฑุฏ ฺฉุณุงู ูุณุชูุฏ - ุชฺฉุช ุจุฏูู ุดุนุจู ุซุจุช ูโุดูุฏ โ

### ูุซุงู ฒ: ุชฺฉุช ุจุง ุดุนุจู ูุนุชุจุฑ
```json
{
  "title": "ูุดฺฉู ุชููู",
  "description": "ุชููู ูุงุญุฏ ุงฺฉุณ ูุทุน ุงุณุช",
  "category": "equipment",
  "branch_id": 1
}
```
**ูุชุฌู**: ุงฺฏุฑ ุดุนุจู ุจุง `id=1` ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏุ ุชฺฉุช ุจุง ุงู ุดุนุจู ุซุจุช ูโุดูุฏ โ

### ูุซุงู ณ: ุชฺฉุช ุจุง ุดุนุจู ูุงูุนุชุจุฑ
```json
{
  "title": "ูุดฺฉู ุชููู",
  "description": "ุชููู ูุงุญุฏ ุงฺฉุณ ูุทุน ุงุณุช",
  "category": "equipment",
  "branch_id": 999
}
```
**ูุชุฌู**: ุงฺฏุฑ ุดุนุจู ุจุง `id=999` ูุฌูุฏ ูุฏุงุดุชู ุจุงุดุฏุ ุชฺฉุช ุจุฏูู ุดุนุจู ุซุจุช ูโุดูุฏ โ

## ๐ ูุดฺฉูุงุช ุฑุงุฌ

### ูุดฺฉู ฑ: ุฎุทุง ForeignKey Constraint
**ุนูุช**: ุงฺฏุฑ `branch_id` ุจู ฺฉ ุดุนุจู ฺฉู ูุฌูุฏ ูุฏุงุฑุฏ ุงุดุงุฑู ฺฉูุฏุ SQLAlchemy ุฎุทุง ูโุฏูุฏ.

**ุฑุงูโุญู**: ฺฉุฏ ูุง ุงู ูุดฺฉู ุฑุง ุจุฑุทุฑู ฺฉุฑุฏู ุงุณุช - ูุจู ุงุฒ ุงุณุชูุงุฏูุ ุจุฑุฑุณ ูโฺฉูุฏ ฺฉู ุดุนุจู ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏ.

### ูุดฺฉู ฒ: branch_id = 0
**ุนูุช**: `0` ฺฉ ุดูุงุณู ูุนุชุจุฑ ูุณุช (ุดุนุจูโูุง ุงุฒ `1` ุดุฑูุน ูโุดููุฏ).

**ุฑุงูโุญู**: ฺฉุฏ ูุง `branch_id <= 0` ุฑุง ุจู `None` ุชุจุฏู ูโฺฉูุฏ.

## ๐ ุจุฑุฑุณ ุดุนุจ ููุฌูุฏ

ุจุฑุง ุฏุฏู ูุณุช ุดุนุจ ููุฌูุฏ:

```bash
# ุงุฒ API
GET /api/branches

# ุง ุงุฒ Swagger
http://127.0.0.1:8000/docs
```

## ๐ Debugging

ุงฺฏุฑ ูุดฺฉู ุฏุงุฑุฏุ ูุงฺฏโูุง ุฑุง ุจุฑุฑุณ ฺฉูุฏ:

```powershell
Get-Content logs/app.log -Tail 100 | Select-String "branch_id"
```

ูุงฺฏโูุง ูุดุงู ูโุฏููุฏ:
- `branch_id` ุงุตู ฺู ุจูุฏู
- ุขุง ุจู `None` ุชุจุฏู ุดุฏู ุง ูู
- ุขุง ุดุนุจู ูพุฏุง ุดุฏู ุง ูู

---

**ูฺฉุชู ููู**: ููุดู ูโุชูุงูุฏ `branch_id` ุฑุง ุญุฐู ฺฉูุฏ ุง `null` ุจูุฑุณุชุฏ - ุชฺฉุช ุจุฏูู ูุดฺฉู ุซุจุช ูโุดูุฏ! โ

