## راهنمای مدیران (Admin Panel)

این راهنما گردش کار مدیران، گزارش‌گیران و کارشناسان IT را در پنل React توضیح می‌دهد.

---

### 1. ورود و نقش‌ها

- دسترسی پنل مدیریتی از `http://localhost:5173`.
- نقش‌های پشتیبانی‌شده:
  - `central_admin`: دسترسی کامل (تنظیمات، زیرساخت، کاربران، SLA، ...).
  - `admin`: مدیریت تیکت، کاربران، SLA، فیلدهای سفارشی.
  - `branch_admin`: مدیریت تیکت‌های شعبه خود و مشاهده گزارش‌ها.
  - `it_specialist`: رسیدگی به تیکت‌ها و SLA.
  - `report_manager`: مشاهده داشبورد و گزارش‌ها (بدون امکان تغییر داده).
- ProtectedRoute تضمین می‌کند هر صفحه مطابق نقش محدود شود و در صورت عدم دسترسی، کاربر به `/login` هدایت می‌شود.

---

### 2. داشبورد مدیریتی

- کارت‌های وضعیت تیکت، نمودارهای SLA، گزارش‌های اولویت/دپارتمان.
- خطاهای API یا انقضای نشست از طریق Global Error Toast اطلاع‌رسانی می‌شود.
- امکان Export گزارش‌ها از طریق منوی Reports.

---

### 3. مدیریت تیکت‌ها

- مسیر `/tickets` برای مشاهده، فیلتر و به‌روزرسانی وضعیت.
- `TicketDetail` شامل:
  - تب تاریخچه، لاگ SLA، تایم‌لاگ، فیلدهای سفارشی.
  - امکان افزودن کامنت داخلی یا کاربرمحور، پیوست فایل، تغییر اولویت.
- Time Tracker برای ثبت مدت زمان صرف‌شده روی هر تیکت.

---

### 4. شعب و دپارتمان‌ها

- `/branches`: ایجاد/ویرایش شعب، تخصیص مدیران شعبه، وضعیت فعال/غیرفعال.
- `/departments`: فقط برای `admin` و `central_admin` جهت تعریف ساختار سازمانی.
- `/infrastructure`: ویژه `central_admin` برای ثبت اطلاعات تجهیزات و لینک‌های هر شعبه.

---

### 5. کاربران و نقش‌ها

- `/users`: ایجاد کاربران جدید، تعیین نقش، زبان پیش‌فرض و اتصال به شعبه/دپارتمان.
- پس از ایجاد کاربر، ایمیل خوشامد ارسال می‌شود (در صورت فعال بودن SMTP).
- قابلیت ریست رمز یا غیرفعال‌سازی حساب از همین صفحه.

---

### 6. Automation و SLA

- `/automation`: تعریف قوانین خودکار (تخصیص، تغییر وضعیت، ارسال اعلان).
- `/sla`:
  - تعریف قوانین SLA بر اساس دسته/اولویت/شعبه.
  - مانیتورینگ لاگ‌ها با فیلتر و گراف‌های تعاملی.
  - در حالت خطا، Escalation به صورت خودکار فعال و در لاگ مشخص می‌شود.

---

### 7. فیلدهای سفارشی و تنظیمات

- `/custom-fields`: تعریف ۱۱ نوع فیلد (متن، انتخابی، تاریخ، فایل و ...)، تعیین شرایط نمایش و اعتبارسنجی.
- `/settings`: ویژه `central_admin` برای تنظیم SMTP، Telegram Bot، بکاپ، و متغیرهای سیستم.

---

### 8. خطاها و مانیتورینگ

- Error Boundary خطاهای رندر را نمایش می‌دهد.
- Global Error Toast پیام‌های 401/500 یا خطاهای شبکه را نشان می‌دهد و به صورت خودکار محو می‌شود.
- برای خطاهای سطح Backend از `logs/app.log` استفاده کنید.

---

### 9. تست‌های کارایی

- اسکریپت جدید `tests/performance/run_performance_tests.py` را با توکن ادمین اجرا و نتایج را در جلسات هفتگی مستند کنید.
- در صورتی که `p95` بالاتر از 400ms شود، لازم است شاخص‌های پایگاه داده و کش بررسی گردد.

---

### 10. چک‌لیست انتشار

1. اجرای تمام تست‌های خودکار (`pytest` + Performance Tests).
2. بررسی تنظیمات `.env` و فعال بودن TLS در ایمیل.
3. سینک بودن مستندات (`README`, `docs/PROJECT_COMPLETE_FEATURES.md`, راهنماهای کاربر/مدیر).
4. تهیه بکاپ با `scripts/backup.sh` یا نسخه ویندوزی.
5. استقرار با `scripts/start_production.sh` یا سرویس Windows.

---

**آخرین به‌روزرسانی:** 2025-11-24

