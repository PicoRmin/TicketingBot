# ุฑุงูููุง ูุงุฒ ถ: ุฑุจุงุช ุชูฺฏุฑุงู / Phase 6: Telegram Bot Guide

## โ ฺฉุงุฑูุง ุงูุฌุงู ุดุฏู

### ฑ. ุฑุงูโุงูุฏุงุฒ ุฒุฑุณุงุฎุช ุฑุจุงุช
- โ ูุตุจ ู ูพฺฉุฑุจูุฏ `python-telegram-bot` ูุณุฎู ฒฐ+
- โ ุงุฌุงุฏ ูุงฺูู ุงุตู ุฑุจุงุช (`app/telegram_bot/bot.py`)
- โ ุซุจุช Lifecycle ฺฉุงูู (start/stopุ error handlerุ post init/shutdown)
- โ ุชูุธู ุชูฺฉู ุงุฒ ุทุฑู ูพฺฉุฑุจูุฏ (`settings.TELEGRAM_BOT_TOKEN`)

### ฒ. ูพุงุฏูโุณุงุฒ ููุฏูุฑูุง ู ููููุง ูฺฉุงููู
- โ ูุนูุงุฑ ูุงฺูู ููุฏูุฑูุง (`app/telegram_bot/handlers.py`)
- โ ููู ุงุตู ุจุง ุฏฺฉููโูุง Inline ุจุฑุง ุฏุณุชูุฑุงุช ฺฉูุฏ
- โ Conversation Handler ุจุฑุง:
  - ูุฑูุฏ (`/login`) ุจุง ุฏุฑุงูุช ูุงู ฺฉุงุฑุจุฑ/ุฑูุฒ
  - ุงุฌุงุฏ ุชฺฉุช (`/newticket`) ุดุงูู ุนููุงูุ ุชูุถุญุ ุฏุณุชูโุจูุฏ ู ูพูุณุช
  - ูพฺฏุฑ ุชฺฉุช (`/track`) ุจุฑ ุงุณุงุณ ุดูุงุฑู ุชฺฉุช
- โ ุฏุณุชูุฑุงุช ูพุงู:
  - `/start`ุ `/help`ุ `/mytickets`, `/track`, `/logout`, `/cancel`
- โ ููู ุชุบุฑ ุฒุจุงู (ูุงุฑุณ/ุงูฺฏูุณ) ุจุง ุฐุฎุฑู ุชุฑุฌุญ ฺฉุงุฑุจุฑ

### ณ. ุงุชุตุงู ุจู API ู ูุฏุฑุช ุงุญุฑุงุฒ ููุช
- โ ูพุงุฏูโุณุงุฒ ูุดุชุฑ HTTP Async (`app/telegram_bot/api_client.py`)
- โ ูุชุฏูุง ูุฑูุฏุ ฺฏุฑูุชู ูพุฑููุงู ฺฉุงุฑุจุฑุ ุงุฌุงุฏ ุชฺฉุชุ ุฏุฑุงูุช ุชฺฉุชโูุง
- โ ุงุฑุณุงู ูุงูโูุง ุชูฺฏุฑุงู ุจู API ูุงู (ุขูพููุฏ ูพูุณุช)
- โ ูุฏุฑุช ูุดุณุช ฺฉุงุฑุจุฑ (ุชูฺฉูุ ุฒุจุงูุ ูพุฑููุงู) ุฏุฑ ุญุงูุธู

### ด. ูพุดุชุจุงู ุฏู ุฒุจุงูู
- โ ุชูุณุนู ูุงู ุชุฑุฌูู ุฏุงุฎู (`app/telegram_bot/i18n.py`)
- โ ุชุฑุฌูู ฺฉุงูู ูพุงูโูุงุ ุฏฺฉููโูุงุ ุฑุงูููุง ู ุฎุทุงูุง ุจู ูุงุฑุณ/ุงูฺฏูุณ
- โ ุชุดุฎุต ุฎูุฏฺฉุงุฑ ุฒุจุงู ฺฉุงุฑุจุฑ ูพุณ ุงุฒ ูุฑูุฏ (ุจุฑ ุงุณุงุณ ูพุฑููุงู API)

## ๐ ุงุฌุฑุง ุฑุจุงุช

### ูพุดโูุงุฒูุง
1. ููุฏุงุฑโุฏู `TELEGRAM_BOT_TOKEN` ุฏุฑ ูุงู `.env`
2. ุงุฌุฑุง ุณุฑูุณ FastAPI (ุจุฑุง ุชุณุช ูุญู):
   ```bash
   uvicorn app.main:app --reload
   ```
3. ูุนุงูโุณุงุฒ ูุญุท ูุฌุงุฒ ู ูุตุจ ูุงุจุณุชฺฏโูุง:
   ```bash
   python -m venv .venv
   .venv\Scripts\activate
   pip install -r requirements.txt
   ```

### ุฑุงูโุงูุฏุงุฒ ุฑุจุงุช ุฏุฑ ุญุงูุช Polling
```bash
python - <<'PY'
import asyncio
from app.telegram_bot.bot import start_bot

asyncio.run(start_bot())
PY
```

### ุชููู ุฑุจุงุช
ุจุฑุง ุชูููุ ุงุฌุฑุง ุจุฑูุงูู ุฑุง ุจุง `Ctrl+C` ูุทุน ฺฉูุฏ. ูุงฺูู `bot.py` ููฺฏุงู ุชููู `stop_bot()` ุฑุง ูุฑุงุฎูุงู ูโฺฉูุฏ ุชุง ููุงุจุน ุขุฒุงุฏ ุดููุฏ.

## ๐งช ุณูุงุฑููุง ุชุณุช

1. **ูุฑูุฏ ฺฉุงุฑุจุฑ**
   - ุฏุฑ ุชูฺฏุฑุงู `/login` ุฑุง ุงุฑุณุงู ฺฉูุฏ
   - ูุงู ฺฉุงุฑุจุฑ ู ุฑูุฒ ุนุจูุฑ ุงุฏูู (ุง ฺฉุงุฑุจุฑ ุชุณุช) ุฑุง ูุงุฑุฏ ฺฉูุฏ
   - ูพุงู ููููุช ูุฑูุฏ ุฑุง ุจุฑุฑุณ ฺฉูุฏ

2. **ุงุฌุงุฏ ุชฺฉุช ุฌุฏุฏ**
   - `/newticket`
   - ุนููุงู โ ุชูุถุญ โ ุงูุชุฎุงุจ ุฏุณุชูโุจูุฏ (ฺฉูุฏูุง Inline)
   - ุงุฑุณุงู ูุงู (Document ุง Photo) ู ูุดุงูุฏู ูพุงู ุฐุฎุฑู ูููู
   - ุงุฑุณุงู "ุชูุงู" ุง ุงุณุชูุงุฏู ุงุฒ ุฏฺฉูู ยซุจุฏูู ูุงูยป ุจุฑุง ูพุงุงู

3. **ูุดุงูุฏู ุชฺฉุชโูุง ูู**
   - `/mytickets`
   - ุจุฑุฑุณ ุดูุฏ ฺฉู ูุณุช ุจุง ุงุทูุงุนุงุช ู ุชุฑุฌูู ุตุญุญ ููุงุด ุฏุงุฏู ุดูุฏ

4. **ูพฺฏุฑ ุชฺฉุช**
   - `/track`
   - ูุงุฑุฏ ฺฉุฑุฏู ุดูุงุฑู ุชฺฉุช ูุนุชุจุฑ โ ุจุฑุฑุณ ุงุทูุงุนุงุช
   - ูุงุฑุฏ ฺฉุฑุฏู ุดูุงุฑู ูุงุฏุฑุณุช โ ุจุฑุฑุณ ูพุงู ุฎุทุง

5. **ุชุบุฑ ุฒุจุงู**
   - ุงุฒ ููู ุงุตู ฺฏุฒูู ยซ๐ ุชุบุฑ ุฒุจุงูยป ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ
   - ุฒุจุงู ุฑุง ุจู ุงูฺฏูุณ ุชุบุฑ ุฏูุฏ ู ูพุงูโูุง ุจุนุฏ ุฑุง ุจุฑุฑุณ ฺฉูุฏ

6. **ุฎุฑูุฌ**
   - `/logout` ุง ุงุณุชูุงุฏู ุงุฒ ุฏฺฉูู ุฎุฑูุฌ ุฏุฑ ููู ุงุตู
   - ุงุทููุงู ุงุฒ ูพุงฺฉ ุดุฏู ุชูฺฉู ู ุจุงุฒฺฏุดุช ุจู ุญุงูุช ูููุงู

## ๐ ุณุงุฎุชุงุฑ ูุงูโูุง ุงูุฒูุฏู/ุจูโุฑูุฒุดุฏู

```
app/
โโโ telegram_bot/
    โโโ __init__.py
    โโโ api_client.py        โ ฺฉูุงูุช HTTP ุจุฑุง ุงุฑุชุจุงุท ุจุง API
    โโโ bot.py               โ ุฑุงูโุงูุฏุงุฒ ู ฺุฑุฎู ุนูุฑ ุฑุจุงุช
    โโโ callbacks.py         โ ุซุงุจุชโูุง ูุฑุจูุท ุจู CallbackData
    โโโ config.py            โ ุฎูุงูุฏู ุชูุธูุงุช
    โโโ i18n.py              โ ูพุงูโูุง ฺูุฏุฒุจุงูู
    โโโ keyboards.py         โ ุณุงุฎุช ฺฉุจูุฑุฏูุง Inline
    โโโ runtime.py           โ ุงุดุง ุงุดุชุฑุงฺฉ (ฺฉูุงูุช HTTP)
    โโโ sessions.py          โ ูุฏุฑุช ูุดุณุช ฺฉุงุฑุจุฑุงู
    โโโ states.py            โ ุญุงูุชโูุง ูฺฉุงููู
    โโโ utils.py             โ ุชูุงุจุน ฺฉูฺฉ ุนููู
    โโโ handlers/
        โโโ __init__.py      โ ุซุจุช ูููโ ููุฏูุฑูุง ุฏุฑ Application
        โโโ auth.py          โ ูฺฉุงููู ูุฑูุฏ/ุฎุฑูุฌ
        โโโ common.py        โ ุชูุงุจุน ูุดุชุฑฺฉ ุจู ููุฏูุฑูุง
        โโโ language.py      โ ุงูุชุฎุงุจ ุฒุจุงู
        โโโ start.py         โ ุฏุณุชูุฑุงุช /start ู /help
        โโโ ticket.py        โ ุชฺฉุช ุฌุฏุฏุ ูพูุณุช ู ูุณุช ุชฺฉุชโูุง
        โโโ track.py         โ ูพฺฏุฑ ุชฺฉุช
```

## ๐ ูฺฉุงุช ุงููุช ู ุนููุงุช

- ุชูฺฉู ุฑุจุงุช ุฑุง ุฏุฑ `.env` ูฺฏู ุฏุงุฑุฏ ู ูุฑฺฏุฒ ุฏุฑ Git commit ูฺฉูุฏ.
- ุจุฑุง ูุญุท Production ุจูุชุฑ ุงุณุช ุงุฒ **Webhook** ุจู ุฌุง Polling ุงุณุชูุงุฏู ุดูุฏ.
- ูุดุณุชโูุง ฺฉุงุฑุจุฑุงู ูุนูุงู ุฏุฑ ุญุงูุธูโ ุฑุจุงุช ูฺฏูุฏุงุฑ ูโุดูุฏุ ุฏุฑ ุงุณุชูุฑุงุฑูุง ุจููุฏูุฏุช ุชูุตู ูโุดูุฏ ุงุฒ ูพุงฺฏุงู ุฏุงุฏู ุง Redis ุงุณุชูุงุฏู ุดูุฏ.
- ูุญุฏูุฏุณุงุฒ ูุฑุฎ (Rate Limiting) ู ูุฏุฑุช ุฎุทุงูุง ุฑุง ุฏุฑ ุงุณุชูุฑุงุฑ ููุง ุฏุฑ ูุธุฑ ุจฺฏุฑุฏ.

## โ ฺฺฉโูุณุช ุชฺฉูู ูุงุฒ ถ

- [x] ุณุงุฎุชุงุฑ ุฑุจุงุช ุชูฺฏุฑุงู ุฑุงูโุงูุฏุงุฒ ุดุฏ
- [x] ุชูุงู ุฏุณุชูุฑุงุช ุงุตู ู ููู ูพุงุฏูโุณุงุฒ ุดุฏ
- [x] ุฌุฑุงู ุงุฌุงุฏ ุชฺฉุช ุจุง Conversation Handler
- [x] ูพฺฏุฑ ู ูุณุช ุชฺฉุชโูุง ูุชุตู ุจู API
- [x] ูพุดุชุจุงู ฺฉุงูู ุงุฒ ูุงุฑุณ/ุงูฺฏูุณ
- [x] ุฏุฑุงูุช ู ุงุฑุณุงู ูุงู ุจู API ูุงู
- [x] ูุฏุฑุช ูุดุณุช ฺฉุงุฑุจุฑ (ุชูฺฉูุ ุฒุจุงู)
- [ ] ุณุณุชู ุงุนูุงู ุชุบุฑ ูุถุนุช ุชฺฉุช (ุจุฑุง ูุณุฎูโูุง ุจุนุฏ)

## ๐ฏ ูุฑุงุญู ุจุนุฏ

- ูพุงุฏูโุณุงุฒ ุณุณุชู ุงุนูุงู (Notification) ุจุฑุง ุชุบุฑ ูุถุนุช ุชฺฉุชโูุง (ุชูฺฏุฑุงูุ ุงูู)
- ุฐุฎุฑูโุณุงุฒ ูุดุณุชโูุง ุฏุฑ ูพุงฺฏุงู ุฏุงุฏู ุจุฑุง ุงุณุชูุฑุงุฑ ูพุงุฏุงุฑ
- ุงูุฒูุฏู ูุงุจูุช Refresh Token ุฏุฑ ุณูุช ุฑุจุงุช ุจุฑุง ุฌูุณุงุช ุทููุงู
- ุงุณุชูุฑุงุฑ ุฏุฑ ุณุฑูุฑ Production ุจุง Webhook ู SSL (Nginx ุง ุณุฑูุณโุฏููุฏู ุงุจุฑ)

---

**ุชุงุฑุฎ ุชฺฉูู:** 2024-11-11

